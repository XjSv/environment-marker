{"version":3,"sources":["content.js"],"names":["insertRibbon","color","url","label","fontSize","position","size","fontData","removeExistingRibbon","removeExistingStylesheets","ribbonWrapper","document","createElement","ribbon","ribbonText","textColor","hexColor","replace","r","parseInt","substr","g","b","getContrastYIQ","undefined","className","textContent","appendChild","fontTmp","split","fontLocation","font","variant","weight","italic","test","setAttribute","googleFontStylesheet","href","type","rel","head","style","innerHTML","body","existingRibbons","querySelectorAll","remove","existingStylesheet","stylesheet","window","hasRun","browser","runtime","onMessage","addListener","message","command","Promise","resolve"],"mappings":"CAAA,WAcE,SAASA,EAAaC,EAAOC,EAAKC,EAAOC,EAAUC,EAAUC,EAAMC,GACjEC,IACAC,IAEA,IAAIC,EAAgBC,SAASC,cAAc,OACvCC,EAASF,SAASC,cAAc,OAChCE,EAAaH,SAASC,cAAc,OACpCG,EAwDN,SAAwBC,GACtBA,EAAWA,EAASC,QAAQ,IAAK,IACjC,IAAIC,EAAIC,SAASH,EAASI,OAAO,EAAG,GAAI,IACpCC,EAAIF,SAASH,EAASI,OAAO,EAAG,GAAI,IACpCE,EAAIH,SAASH,EAASI,OAAO,EAAG,GAAI,IAGxC,OAFgB,IAAJF,EAAgB,IAAJG,EAAgB,IAAJC,GAAY,KAEjC,IAAO,QAAU,QA/DhBC,CAAetB,GAqB/B,QAjBiBuB,IAAbpB,IACFA,EAAW,WAKAoB,IAATlB,IACFA,EAAO,UAGTI,EAAce,UAAY,wBAA0BpB,EAAW,eAAiBC,EAAO,kBACvFO,EAAOY,UAAY,gBAAkBnB,EAAO,cAAgBD,EAAW,UACvES,EAAWW,UAAY,kBACvBX,EAAWY,YAAcvB,EACzBU,EAAOc,YAAYb,GACnBJ,EAAciB,YAAYd,GAEtBN,EAAU,CACZ,IAAIqB,EAAUrB,EAASsB,MAAM,KACzBC,EAAeF,EAAQ,GACvBG,EAAOH,EAAQ,GACfI,EAAUJ,EAAQ,IAAM,MACxBK,EAASd,SAASa,EAAQ,IAC1BE,EAAS,KAAKC,KAAKH,GAUvB,GARAnB,EAAOuB,aAAa,QAChB,qBAAuBnC,EACvB,YAAcc,EACd,gBAAkBX,EAClB,qBAAuB2B,EACvB,mBAAqBE,EACrB,kBAAoBC,EAAS,SAAW,UAAY,KAEnC,WAAjBJ,EAA2B,CAC7B,IAAIO,EAAuB1B,SAASC,cAAc,QAC9CyB,EAAqBC,KAAO,2CAA6CP,EAAO,IAAMC,EAAU,gBAChGK,EAAqBE,KAAO,WAC5BF,EAAqBG,IAAM,aAC3BH,EAAqBZ,UAAY,uBAErCd,SAAS8B,KAAKd,YAAYU,OACrB,CACL,IAAIK,EAAQ/B,SAASC,cAAc,SACnC8B,EAAMC,UAAY,6BAA+BZ,EAAO,iBAAmBA,EAAO,wCAA0CA,EAAO,4BACnIpB,SAAS8B,KAAKd,YAAYe,SAG5B7B,EAAOuB,aAAa,QAAS,qBAAuBnC,EAAQ,YAAcc,EAAY,gBAAkBX,EAAW,OAErHO,SAASiC,KAAKjB,YAAYjB,GAgB5B,SAASF,IACP,IAAIqC,EAAkBlC,SAASmC,iBAAiB,sBAChD,IAAK,IAAIjC,KAAUgC,EACjBhC,EAAOkC,SAOX,SAAStC,IACP,IAAIuC,EAAqBrC,SAASmC,iBAAiB,yBACnD,IAAK,IAAIG,KAAcD,EACrBC,EAAWF,SAjGXG,OAAOC,QAA4B,oBAAXC,UAG5BF,OAAOC,QAAS,EAsGhBC,QAAQC,QAAQC,UAAUC,YAAcC,IACd,cAApBA,EAAQC,QACVzD,EAAawD,EAAQvD,MAAOuD,EAAQtD,IAAKsD,EAAQrD,MAAOqD,EAAQpD,SAAUoD,EAAQnD,SAAUmD,EAAQlD,KAAMkD,EAAQzB,MACrF,UAApByB,EAAQC,UACjBjD,IACAC,KAEKiD,QAAQC,QAAQ,WAtH3B","file":"content.min.js","sourcesContent":["(function() {\r\n  /**\r\n   * Check and set a global guard variable.\r\n   * If this content script is injected into the same page again,\r\n   * it will do nothing next time.\r\n   */\r\n  if (window.hasRun || typeof browser == \"undefined\") {\r\n    return;\r\n  }\r\n  window.hasRun = true;\r\n\r\n  /**\r\n   * Given a URL, background color create a ribbon and add it to the page.\r\n   */\r\n  function insertRibbon(color, url, label, fontSize, position, size, fontData) {\r\n    removeExistingRibbon();\r\n    removeExistingStylesheets();\r\n\r\n    let ribbonWrapper = document.createElement('div'),\r\n        ribbon = document.createElement('div'),\r\n        ribbonText = document.createElement('div'),\r\n        textColor = getContrastYIQ(color);\r\n\r\n    // For backwards compatibility for users that already have ribbons configured.\r\n    // @TODO: Remove sometime in the future\r\n    if (fontSize === undefined) {\r\n      fontSize = '14'\r\n    }\r\n\r\n    // For backwards compatibility for users that already have ribbons configured.\r\n    // @TODO: Remove sometime in the future\r\n    if (size === undefined) {\r\n      size = 'normal'\r\n    }\r\n\r\n    ribbonWrapper.className = 'em-ribbon-wrapper em-' + position + '-wrapper em-' + size + '-ribbon-wrapper';\r\n    ribbon.className = 'em-ribbon em-' + size + '-ribbon em-' + position + '-ribbon';\r\n    ribbonText.className = 'em-ribbon-label';\r\n    ribbonText.textContent = label;\r\n    ribbon.appendChild(ribbonText);\r\n    ribbonWrapper.appendChild(ribbon);\r\n\r\n    if (fontData) {\r\n      let fontTmp = fontData.split(':'),\r\n          fontLocation = fontTmp[0],\r\n          font = fontTmp[1],\r\n          variant = fontTmp[2] || '400',\r\n          weight = parseInt(variant,10),\r\n          italic = /i$/.test(variant);\r\n\r\n      ribbon.setAttribute('style',\r\n          \"background-color: \" + color +\r\n          \"; color: \" + textColor +\r\n          \"; font-size: \" + fontSize +\r\n          \"px; font-family: '\" + font +\r\n          \"'; font-weight: \" + weight +\r\n          \"; font-style: \" + (italic ? 'italic' : 'normal') + \";\");\r\n\r\n      if (fontLocation === 'google') {\r\n        let googleFontStylesheet = document.createElement('link');\r\n            googleFontStylesheet.href = 'https://fonts.googleapis.com/css?family=' + font + ':' + variant + '&display=swap';\r\n            googleFontStylesheet.type = 'text/css';\r\n            googleFontStylesheet.rel = 'stylesheet';\r\n            googleFontStylesheet.className = 'em-google-stylesheet';\r\n\r\n        document.head.appendChild(googleFontStylesheet);\r\n      } else {\r\n        let style = document.createElement('style');\r\n        style.innerHTML = \"@font-face { font-family:'\" + font + \"'; src:local('\" + font + \"'), url('/libraries/fontpicker/fonts/\" + font + \".woff') format('woff'); }\";\r\n        document.head.appendChild(style);\r\n      }\r\n    } else {\r\n      ribbon.setAttribute('style', \"background-color: \" + color + \"; color: \" + textColor + \"; font-size: \" + fontSize + \"px;\");\r\n    }\r\n    document.body.appendChild(ribbonWrapper);\r\n  }\r\n\r\n  function getContrastYIQ(hexColor) {\r\n    hexColor = hexColor.replace('#', '');\r\n    let r = parseInt(hexColor.substr(0, 2), 16),\r\n        g = parseInt(hexColor.substr(2, 2), 16),\r\n        b = parseInt(hexColor.substr(4, 2), 16),\r\n        yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;\r\n\r\n    return (yiq >= 128) ? 'black' : 'white';\r\n  }\r\n\r\n  /**\r\n   * Remove any existing ribbons from the page.\r\n   */\r\n  function removeExistingRibbon() {\r\n    let existingRibbons = document.querySelectorAll('.em-ribbon-wrapper');\r\n    for (let ribbon of existingRibbons) {\r\n      ribbon.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove any stylesheets that have been previously injected from the page.\r\n   */\r\n  function removeExistingStylesheets() {\r\n    let existingStylesheet = document.querySelectorAll('.em-google-stylesheet');\r\n    for (let stylesheet of existingStylesheet) {\r\n      stylesheet.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen for messages from the background script.\r\n   * Call \"insertRibbon()\" or \"removeExistingRibbon()\".\r\n  */\r\n  browser.runtime.onMessage.addListener( (message) => {\r\n    if (message.command === 'addRibbon') {\r\n      insertRibbon(message.color, message.url, message.label, message.fontSize, message.position, message.size, message.font);\r\n    } else if (message.command === 'reset') {\r\n      removeExistingRibbon();\r\n      removeExistingStylesheets();\r\n    }\r\n    return Promise.resolve('done');\r\n  });\r\n\r\n})();\r\n"]}