const TAB_COUNT_COLOR_LIMIT=10,TAB_COUNT_COLOR_LOW="#28a745",TAB_COUNT_COLOR_HIGH="#dc3545",extensionEnabledKey="__em-enabled__",markersKey="__em-markers__",searchModeKey="__em-search-mode__",tabCounterKey="__em-tab-counter__",faviconMarkerKey="__em-favicon-marker__",fontKey="__em-font__";function onError(e){console.log(e)}function updateCount(e,t){browser.storage.sync.get(tabCounterKey).then((r=>{r[tabCounterKey]||!1?browser.tabs.query({}).then((r=>{let n=r.length;t&&e&&r.map((e=>e.id)).includes(e)&&n--,browser.browserAction.setBadgeText({text:n.toString()}),n>10?browser.browserAction.setBadgeBackgroundColor({color:"#dc3545"}):browser.browserAction.setBadgeBackgroundColor({color:"#28a745"})})):browser.browserAction.setBadgeText({text:""})}))}function clearCount(){browser.browserAction.setBadgeText({text:""})}function updateContent(e){void 0!==e&&browser.tabs.get(e).then((t=>{""!==t.url&&browser.storage.sync.get([fontKey,searchModeKey,markersKey,faviconMarkerKey]).then((r=>{let n=r[fontKey]||"",o=r[searchModeKey]||!1,s=r[faviconMarkerKey]||!1;if(r[markersKey])for(let a of r[markersKey]){let r=!1;if(o){r=new RegExp(a.settingUrl,"iu").test(t.url)}else r=-1!==t.url.indexOf(a.settingUrl);r&&(browser.tabs.executeScript(e,{file:"/js/content.min.js"}).then((()=>{browser.tabs.sendMessage(e,{command:"addRibbon",url:a.settingUrl,color:a.settingColor,label:a.settingLabel,fontSize:a.settingFontSize,position:a.settingPosition,size:a.settingSize,font:n,enableFaviconMarker:s}).then((e=>{})).catch(onError)}),onError),browser.tabs.insertCSS(e,{file:"/css/content.min.css"}).then(null,onError))}}))}),onError)}browser.storage.sync.get("__em-enabled__").then((e=>{(void 0===e["__em-enabled__"]||e["__em-enabled__"])&&initialize()}),onError),browser.runtime.onMessage.addListener((function(e,t,r){"toggleExtensionOnOff"===e.cmd&&browser.storage.sync.set({"__em-enabled__":e.data.value}).then((()=>{e.data.value?initialize():removeListeners()}),onError)}));let onRemovedListener=function(e,t){updateCount(e,!0)},onCreatedListener=function(e){updateCount(e.id,!1)},onUpdatedListener=function(e,t,r){"complete"===t.status&&updateContent(e)};function initialize(){browser.tabs.onRemoved.addListener(onRemovedListener),browser.tabs.onCreated.addListener(onCreatedListener),browser.tabs.onUpdated.addListener(onUpdatedListener),updateCount()}function removeListeners(){browser.tabs.onRemoved.removeListener(onRemovedListener),browser.tabs.onCreated.removeListener(onCreatedListener),browser.tabs.onUpdated.removeListener(onUpdatedListener),clearCount()}