const TAB_COUNT_COLOR_LIMIT=10,TAB_COUNT_COLOR_LOW="#28a745",TAB_COUNT_COLOR_HIGH="#dc3545",markersKey="__em-markers__",searchModeKey="__em-search-mode__",tabCounterKey="__em-tab-counter__",faviconMarkerKey="__em-favicon-marker__",fontKey="__em-font__";function onError(e){console.log(e)}function updateCount(e,t){browser.storage.sync.get(tabCounterKey).then((r=>{r[tabCounterKey]||!1?browser.tabs.query({}).then((r=>{let o=r.length;t&&e&&r.map((e=>e.id)).includes(e)&&o--,browser.browserAction.setBadgeText({text:o.toString()}),o>10?browser.browserAction.setBadgeBackgroundColor({color:"#dc3545"}):browser.browserAction.setBadgeBackgroundColor({color:"#28a745"})})):browser.browserAction.setBadgeText({text:""})}))}function updateContent(e){void 0!==e&&browser.tabs.get(e).then((t=>{""!==t.url&&browser.storage.sync.get([fontKey,searchModeKey,markersKey,faviconMarkerKey]).then((r=>{let o=r[fontKey]||"",n=r[searchModeKey]||!1,s=r[faviconMarkerKey]||!1;if(r[markersKey])for(let a of r[markersKey]){let r=!1;if(n){r=new RegExp(a.settingUrl,"iu").test(t.url)}else r=-1!==t.url.indexOf(a.settingUrl);r&&(browser.tabs.executeScript(e,{file:"/js/content.min.js"}).then((()=>{browser.tabs.sendMessage(e,{command:"addRibbon",url:a.settingUrl,color:a.settingColor,label:a.settingLabel,fontSize:a.settingFontSize,position:a.settingPosition,size:a.settingSize,font:o,enableFaviconMarker:s}).then((e=>{})).catch(onError)}),onError),browser.tabs.insertCSS(e,{file:"/css/content.min.css"}).then(null,onError))}}))}),onError)}browser.tabs.onRemoved.addListener(((e,t)=>{updateCount(e,!0)})),browser.tabs.onCreated.addListener((e=>{updateCount(e.id,!1)})),browser.tabs.onUpdated.addListener(((e,t,r)=>{"complete"===t.status&&updateContent(e)})),updateCount();