const TAB_COUNT_COLOR_LIMIT=10,TAB_COUNT_COLOR_LOW="#28a745",TAB_COUNT_COLOR_HIGH="#dc3545",extensionEnabledKey="__em-enabled__",markersKey="__em-markers__",searchModeKey="__em-search-mode__",tabCounterKey="__em-tab-counter__",faviconMarkerKey="__em-favicon-marker__",fontKey="__em-font__";function onError(e){console.log(e)}function updateCount(e,t){chrome.storage.sync.get(tabCounterKey).then((n=>{n[tabCounterKey]||!1?chrome.tabs.query({}).then((n=>{let o=n.length;t&&e&&n.map((e=>e.id)).includes(e)&&o--,chrome.action.setBadgeText({text:o.toString()}),o>10?chrome.action.setBadgeBackgroundColor({color:"#dc3545"}):chrome.action.setBadgeBackgroundColor({color:"#28a745"})})):chrome.action.setBadgeText({text:""})}))}function clearCount(){chrome.action.setBadgeText({text:""})}function updateContent(e){void 0!==e&&chrome.tabs.get(e).then((t=>{""!==t.url&&chrome.storage.sync.get([fontKey,searchModeKey,markersKey,faviconMarkerKey]).then((n=>{let o=n[fontKey]||"",r=n[searchModeKey]||!1,a=n[faviconMarkerKey]||!1;if(n[markersKey])for(let s of n[markersKey]){let n=!1;if(r){n=new RegExp(s.settingUrl,"iu").test(t.url)}else n=-1!==t.url.indexOf(s.settingUrl);n&&(chrome.scripting.executeScript({target:{tabId:e},files:["/js/content.min.js"]}).then((()=>{chrome.tabs.sendMessage(e,{command:"addRibbon",url:s.settingUrl,color:s.settingColor,label:s.settingLabel,fontSize:s.settingFontSize,position:s.settingPosition,size:s.settingSize,font:o,enableFaviconMarker:a}).then((e=>{void 0!==e&&(console.log("Message from the content script:"),console.log(e))})).catch(onError)}),onError),chrome.scripting.insertCSS({target:{tabId:e},files:["/css/content.min.css"]}).then(null,onError))}}))}),onError)}chrome.storage.sync.get("__em-enabled__").then((e=>{(void 0===e["__em-enabled__"]||e["__em-enabled__"])&&initialize()}),onError),chrome.runtime.onMessage.addListener((function(e,t,n){"toggleExtensionOnOff"===e.cmd&&chrome.storage.sync.set({"__em-enabled__":e.data.value}).then((()=>{e.data.value?initialize():removeListeners()}),onError)}));let onRemovedListener=function(e,t){updateCount(e,!0)},onCreatedListener=function(e){updateCount(e.id,!1)},onUpdatedListener=function(e,t,n){"complete"===t.status&&updateContent(e)};function initialize(){chrome.tabs.onRemoved.addListener(onRemovedListener),chrome.tabs.onCreated.addListener(onCreatedListener),chrome.tabs.onUpdated.addListener(onUpdatedListener),updateCount()}function removeListeners(){chrome.tabs.onRemoved.removeListener(onRemovedListener),chrome.tabs.onCreated.removeListener(onCreatedListener),chrome.tabs.onUpdated.removeListener(onUpdatedListener),clearCount()}