let inputUrlFragmentPlaceholder=browser.i18n.getMessage("inputUrlFragmentPlaceholder"),inputColorPlaceholder=browser.i18n.getMessage("inputColorPlaceholder"),inputLabelPlaceholder=browser.i18n.getMessage("inputLabelPlaceholder"),positionSelectTopLeft=browser.i18n.getMessage("positionSelectTopLeft"),positionSelectTopRight=browser.i18n.getMessage("positionSelectTopRight"),positionSelectBottomLeft=browser.i18n.getMessage("positionSelectBottomLeft"),positionSelectBottomRight=browser.i18n.getMessage("positionSelectBottomRight"),sizeSelectExtraSmall=browser.i18n.getMessage("sizeSelectExtraSmall"),sizeSelectSmall=browser.i18n.getMessage("sizeSelectSmall"),sizeSelectNormal=browser.i18n.getMessage("sizeSelectNormal"),sizeSelectLarge=browser.i18n.getMessage("sizeSelectLarge"),sizeSelectExtraLarge=browser.i18n.getMessage("sizeSelectExtraLarge"),noticeNoRibbons=browser.i18n.getMessage("noticeNoRibbons"),buttonClearAll=browser.i18n.getMessage("buttonClearAll"),buttonImportExport=browser.i18n.getMessage("buttonImportExport"),errorDuplicateMarker=browser.i18n.getMessage("errorDuplicateMarker"),errorLabelEmpty=browser.i18n.getMessage("errorLabelEmpty"),errorUrlEmpty=browser.i18n.getMessage("errorUrlEmpty"),colorPickerUiDialog=browser.i18n.getMessage("colorPickerUiDialog"),colorPickerBtnToggle=browser.i18n.getMessage("colorPickerBtnToggle"),colorPickerBtnSwatch=browser.i18n.getMessage("colorPickerBtnSwatch"),colorPickerBtnLastColor=browser.i18n.getMessage("colorPickerBtnLastColor"),colorPickerBtnSave=browser.i18n.getMessage("colorPickerBtnSave"),colorPickerBtnCancel=browser.i18n.getMessage("colorPickerBtnCancel"),colorPickerBtnClear=browser.i18n.getMessage("colorPickerBtnClear"),colorPickerAriaBtnSave=browser.i18n.getMessage("colorPickerAriaBtnSave"),colorPickerAriaBtnCancel=browser.i18n.getMessage("colorPickerAriaBtnCancel"),colorPickerAriaBtnClear=browser.i18n.getMessage("colorPickerAriaBtnClear"),colorPickerAriaInput=browser.i18n.getMessage("colorPickerAriaInput"),colorPickerAriaPalette=browser.i18n.getMessage("colorPickerAriaPalette"),colorPickerAriaHue=browser.i18n.getMessage("colorPickerAriaHue"),colorPickerAriaOpacity=browser.i18n.getMessage("colorPickerAriaOpacity"),displayAt=browser.i18n.getMessage("displayAt"),pickr=null,colorSwatches=["rgba(244, 67,  54, 1)","rgba(233, 30,  99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63,  81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3,  169, 244, 1)"];const swatchesKey="__em-swatches__",markersKey="__em-markers__",maxSwatches=7,hide="none",show="block",positionsMap=[{value:"top-left",label:positionSelectTopLeft},{value:"top-right",label:positionSelectTopRight},{value:"bottom-left",label:positionSelectBottomLeft},{value:"bottom-right",label:positionSelectBottomRight}],sizesMap=[{value:"extra-small",label:sizeSelectExtraSmall},{value:"small",label:sizeSelectSmall},{value:"normal",label:sizeSelectNormal},{value:"large",label:sizeSelectLarge},{value:"extra-large",label:sizeSelectExtraLarge}];function onError(e){console.log(e)}function truncateString(e,t){return e.length<=t?e:e.slice(0,t)+"..."}function initialize(){browser.storage.local.get(markersKey).then(e=>{let t=e[markersKey]||[];if(t.length>0){showOrHideEmptyNotice(hide);for(let e of t)displaySetting(e.settingUrl,e.settingColor,e.settingLabel,e.settingPosition,e.settingSize)}else showOrHideEmptyNotice(show)},onError)}function showOrHideEmptyNotice(e=null){e!==show&&e!==hide?browser.storage.local.get(markersKey).then(e=>{$(".empty-notice").css("display",e[markersKey].length>0?"none":"block")},onError):$(".empty-notice").css("display",e)}function saveSwatches(e){browser.storage.local.set({[swatchesKey]:e}).then(null,onError)}function showMessage(e,t=!1){let r=t?"alert-danger":"alert-success";$(".outer-wrapper .message-container .alert").length?($(".outer-wrapper .message-container .alert").remove(),$(".outer-wrapper .message-container").append('<div class="alert '+r+' col-12">'+e+"</div>")):$(".outer-wrapper .message-container").append('<div class="alert '+r+' col-12">'+e+"</div>")}function searchStoredMarkers(e,t){for(let r=0;r<t.length;r++)if(t[r].settingUrl===e)return t[r]}function saveSettings(){let e=$(".settings-input #url").val(),t=pickr.getSelectedColor().toHEXA().toString(0),r=$(".settings-input #label").val(),o=$(".settings-input #position").val(),a=$(".settings-input #size").val();""!==e&&""!==t&&""!==r?browser.storage.local.get(markersKey).then(l=>{let i=l[markersKey]||[];searchStoredMarkers(e,i)?showMessage(errorDuplicateMarker):($(".outer-wrapper .message-container .alert").length&&$(".outer-wrapper .message-container .alert").remove(),$(".settings-input #url").val(""),$(".settings-input #label").val(""),$(".settings-input #position").val("top-left"),$(".settings-input #size").val("normal"),storeSetting(l,e,t,r,o,a))},onError):showMessage(""===r?errorLabelEmpty:errorUrlEmpty)}function storeSetting(e,t,r,o,a,l){let i=e[markersKey]||[],s={settingUrl:t,settingColor:r,settingLabel:o,settingPosition:a,settingSize:l};i.unshift(s),browser.storage.local.set({[markersKey]:i}).then(()=>{showOrHideEmptyNotice(hide),displaySetting(t,r,o,a,l)},onError)}function updateSetting(e,t,r,o,a,l){browser.storage.local.get(markersKey).then(i=>{let s=i[markersKey]||[];if(searchStoredMarkers(e,s)){let i=s.filter((function(i){return i.settingUrl===e&&(i.settingUrl=t,i.settingColor=r,i.settingLabel=o,i.settingPosition=a,i.settingSize=l),!0}));browser.storage.local.set({[markersKey]:i}).then(()=>{displaySetting(t,r,o,a,l)},onError)}},onError)}function deleteSetting(e){browser.storage.local.get(markersKey).then(t=>{let r=t[markersKey]||[];if(searchStoredMarkers(e,r)){let t=r.filter((function(t){return t.settingUrl!==e}));browser.storage.local.set({[markersKey]:t}).then(null,onError)}},onError)}function clearAll(){$(".settings-container .setting").each((e,t)=>{t.remove()}),browser.storage.local.set({[markersKey]:[]}).then(null,onError),showOrHideEmptyNotice(show)}function displaySetting(e,t,r,o,a){let l=positionsMap.reduce((function(e,t){return t.value===o&&(e=t.label),e}),{}),i=sizeSelectNormal;void 0!==a?i=sizesMap.reduce((function(e,t){return t.value===a&&(e=t.label),e}),{}):a="normal";let s=$("<div/>",{class:"setting"}),n=$("<div/>",{class:"row no-gutters mb-2 display-container"}),c=$("<div/>",{class:"col-10 pr-2 display-labelUrl",text:truncateString(r,35)+" ("+truncateString(e,35)+") "+i+" "+displayAt+" "+l,click:function(){n.hide(),u.show()}}),p=$("<div/>",{class:"col-1 pr-2 display-color",html:'<div style="background-color: '+t+';"></div>',click:function(){n.hide(),u.show()}}),g=$("<div/>",{class:"col-1 display-delete"}),h=$("<button/>",{class:"btn btn-danger btn-sm delete",html:'<i class="fas fa-trash fa-lg"></i>',click:function(){$(this).parent().parent().parent().remove(),deleteSetting(e),showOrHideEmptyNotice()}}),u=$("<div/>",{class:"row no-gutters mb-2 edit-container",style:"display: none;"}),b=$("<div/>",{class:"col-10 pr-1 mb-2 edit-url-container"}),d=$("<input/>",{class:"form-control edit-url",value:e}),w=$("<div/>",{class:"col-1 pr-1 mb-2 edit-color"}),m=$("<input/>",{class:"color-picker",value:t}),k=$("<div/>",{class:"col-5 pr-2 edit-label-container"}),S=$("<input/>",{class:"form-control edit-label",value:r}),v=$("<div/>",{class:"col-3 pr-2 edit-position-container"}),y=$("<select/>",{class:"form-control edit-position"});for(let e=0;e<positionsMap.length;e++)positionsMap[e].value===o?y.append(new Option(positionsMap[e].label,positionsMap[e].value,!0,!0)):y.append(new Option(positionsMap[e].label,positionsMap[e].value));let P=$("<div/>",{class:"col-3 pr-2 edit-size-container"}),f=$("<select/>",{class:"form-control edit-size"});for(let e=0;e<sizesMap.length;e++)sizesMap[e].value===a?f.append(new Option(sizesMap[e].label,sizesMap[e].value,!0,!0)):f.append(new Option(sizesMap[e].label,sizesMap[e].value));let M=$("<div/>",{class:"col-1 mb-2 edit-delete"}),B=$("<button/>",{class:"btn btn-success btn-sm update",html:'<i class="fas fa-pencil-alt fa-lg"></i>',click:function(){let l=d.val(),i=m.val(),n=S.val(),c=y.val(),p=f.val();l===e&&i===t&&n===r&&c===o&&p===a||(updateSetting(e,l,i,n,c,p),s.remove())}}),A=$("<div/>",{class:"col-1 edit-cancel"}),E=$("<button/>",{class:"btn btn-secondary btn-sm cancel",html:'<i class="fas fa-times fa-lg"></i>',click:function(){n.show(),u.hide(),d.val(e),m.val(t),S.val(r),y.val(o),f.val(a)}});b.append(d),w.append(m),v.append(y),P.append(f),M.append(B),k.append(S),A.append(E),u.append(b),u.append(w),u.append(M),u.append(k),u.append(v),u.append(P),u.append(A),g.append(h),n.append(c),n.append(p),n.append(g),s.append(n),s.append(u),$(".settings-container").append(s),browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]);let r=Pickr.create({el:m[0],theme:"nano",default:t,useAsButton:!1,swatches:colorSwatches,components:{preview:!0,opacity:!1,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}},i18n:{"ui:dialog":colorPickerUiDialog,"btn:toggle":colorPickerBtnToggle,"btn:swatch":colorPickerBtnSwatch,"btn:last-color":colorPickerBtnLastColor,"btn:save":colorPickerBtnSave,"btn:cancel":colorPickerBtnCancel,"btn:clear":colorPickerBtnClear,"aria:btn:save":colorPickerAriaBtnSave,"aria:btn:cancel":colorPickerAriaBtnCancel,"aria:btn:clear":colorPickerAriaBtnClear,"aria:input":colorPickerAriaInput,"aria:palette":colorPickerAriaPalette,"aria:hue":colorPickerAriaHue,"aria:opacity":colorPickerAriaOpacity}});r.on("save",(e,t)=>{m.val(e.toHEXA().toString(0));let o=r.getSwatches();o.includes(e.toRGBA().toString(0))||(7===o.length&&o.pop(),o.unshift(e.toRGBA().toString(0)),r.setSwatches(o),saveSwatches(o)),t.hide()}),r.on("show",()=>{browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),r.setSwatches(colorSwatches)},onError)})},onError)}Pickr.prototype.getSwatches=function(){return this._swatchColors.reduce((e,t)=>(e.push(t.color.toRGBA().toString(0)),e),[])},Pickr.prototype.setSwatches=function(e){if(e.length){for(let e=this._swatchColors.length-1;e>-1;e--)this.removeSwatch(e);e.forEach(e=>this.addSwatch(e))}},$(document).ready(()=>{initialize(),$(".save").click(()=>{saveSettings()}),$(".clear").click(()=>{clearAll()}),$(".import-export").click(()=>{browser.runtime.openOptionsPage()}),$(document).keydown((function(e){if("Enter"!==e.key&&"NumpadEnter"!==e.key||saveSettings(),"Escape"!==e.key)return!0;window.close()})),browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),pickr=Pickr.create({el:".color-picker",theme:"nano",useAsButton:!1,swatches:colorSwatches,components:{preview:!0,opacity:!1,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}},i18n:{"ui:dialog":colorPickerUiDialog,"btn:toggle":colorPickerBtnToggle,"btn:swatch":colorPickerBtnSwatch,"btn:last-color":colorPickerBtnLastColor,"btn:save":colorPickerBtnSave,"btn:cancel":colorPickerBtnCancel,"btn:clear":colorPickerBtnClear,"aria:btn:save":colorPickerAriaBtnSave,"aria:btn:cancel":colorPickerAriaBtnCancel,"aria:btn:clear":colorPickerAriaBtnClear,"aria:input":colorPickerAriaInput,"aria:palette":colorPickerAriaPalette,"aria:hue":colorPickerAriaHue,"aria:opacity":colorPickerAriaOpacity}}),pickr.on("save",(e,t)=>{let r=pickr.getSwatches();r.includes(e.toRGBA().toString(0))||(7===r.length&&r.pop(),r.unshift(e.toRGBA().toString(0)),pickr.setSwatches(r),saveSwatches(r)),t.hide()}),pickr.on("show",()=>{browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),pickr.setSwatches(colorSwatches)},onError)})},onError),$(".empty-notice").html(noticeNoRibbons),$(".clear").html(buttonClearAll),$(".import-export").html(buttonImportExport),$("#url").attr("placeholder",inputUrlFragmentPlaceholder),$("#color").attr("placeholder",inputColorPlaceholder),$("#label").attr("placeholder",inputLabelPlaceholder),$('#position option[value="top-left"]').html(positionSelectTopLeft),$('#position option[value="top-right"]').html(positionSelectTopRight),$('#position option[value="bottom-left"]').html(positionSelectBottomLeft),$('#position option[value="bottom-right"]').html(positionSelectBottomRight),$('#size option[value="extra-small"]').html(sizeSelectExtraSmall),$('#size option[value="small"]').html(sizeSelectSmall),$('#size option[value="normal"]').html(sizeSelectNormal),$('#size option[value="large"]').html(sizeSelectLarge),$('#size option[value="extra-large"]').html(sizeSelectExtraLarge)});
//# sourceMappingURL=environment-marker.min.js.map
