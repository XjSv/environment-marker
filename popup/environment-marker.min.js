let inputUrlFragmentPlaceholder=browser.i18n.getMessage("inputUrlFragmentPlaceholder"),inputUrlFragmentRegExpPlaceholder=browser.i18n.getMessage("inputUrlFragmentRegExpPlaceholder"),inputColorPlaceholder=browser.i18n.getMessage("inputColorPlaceholder"),inputLabelPlaceholder=browser.i18n.getMessage("inputLabelPlaceholder"),positionSelectTopLeft=browser.i18n.getMessage("positionSelectTopLeft"),positionSelectTopRight=browser.i18n.getMessage("positionSelectTopRight"),positionSelectBottomLeft=browser.i18n.getMessage("positionSelectBottomLeft"),positionSelectBottomRight=browser.i18n.getMessage("positionSelectBottomRight"),sizeSelectExtraSmall=browser.i18n.getMessage("sizeSelectExtraSmall"),sizeSelectSmall=browser.i18n.getMessage("sizeSelectSmall"),sizeSelectNormal=browser.i18n.getMessage("sizeSelectNormal"),sizeSelectLarge=browser.i18n.getMessage("sizeSelectLarge"),sizeSelectExtraLarge=browser.i18n.getMessage("sizeSelectExtraLarge"),noticeNoRibbons=browser.i18n.getMessage("noticeNoRibbons"),buttonClearAll=browser.i18n.getMessage("buttonClearAll"),buttonOptions=browser.i18n.getMessage("buttonOptions"),errorDuplicateMarker=browser.i18n.getMessage("errorDuplicateMarker"),errorLabelEmpty=browser.i18n.getMessage("errorLabelEmpty"),errorUrlEmpty=browser.i18n.getMessage("errorUrlEmpty"),colorPickerUiDialog=browser.i18n.getMessage("colorPickerUiDialog"),colorPickerBtnToggle=browser.i18n.getMessage("colorPickerBtnToggle"),colorPickerBtnSwatch=browser.i18n.getMessage("colorPickerBtnSwatch"),colorPickerBtnLastColor=browser.i18n.getMessage("colorPickerBtnLastColor"),colorPickerBtnSave=browser.i18n.getMessage("colorPickerBtnSave"),colorPickerBtnCancel=browser.i18n.getMessage("colorPickerBtnCancel"),colorPickerBtnClear=browser.i18n.getMessage("colorPickerBtnClear"),colorPickerAriaBtnSave=browser.i18n.getMessage("colorPickerAriaBtnSave"),colorPickerAriaBtnCancel=browser.i18n.getMessage("colorPickerAriaBtnCancel"),colorPickerAriaBtnClear=browser.i18n.getMessage("colorPickerAriaBtnClear"),colorPickerAriaInput=browser.i18n.getMessage("colorPickerAriaInput"),colorPickerAriaPalette=browser.i18n.getMessage("colorPickerAriaPalette"),colorPickerAriaHue=browser.i18n.getMessage("colorPickerAriaHue"),colorPickerAriaOpacity=browser.i18n.getMessage("colorPickerAriaOpacity"),displayAt=browser.i18n.getMessage("displayAt"),ariaLabelAlertClose=browser.i18n.getMessage("ariaLabelAlertClose"),languageCode=browser.i18n.getUILanguage(),pickr=null,colorSwatches=["rgba(244, 67,  54, 1)","rgba(233, 30,  99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63,  81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3,  169, 244, 1)"];const swatchesKey="__em-swatches__",markersKey="__em-markers__",dbVersionKey="__em-version__",searchModeKey="__em-search-mode__",maxSwatches=7,hide="none",show="block",fontSizeMap=[{value:"10",label:"10px"},{value:"12",label:"12px"},{value:"14",label:"14px"},{value:"16",label:"16px"},{value:"18",label:"18px"}],positionsMap=[{value:"top-left",label:positionSelectTopLeft},{value:"top-right",label:positionSelectTopRight},{value:"bottom-left",label:positionSelectBottomLeft},{value:"bottom-right",label:positionSelectBottomRight}],sizesMap=[{value:"extra-small",label:sizeSelectExtraSmall},{value:"small",label:sizeSelectSmall},{value:"normal",label:sizeSelectNormal},{value:"large",label:sizeSelectLarge},{value:"extra-large",label:sizeSelectExtraLarge}];function onError(e){console.log(e)}function truncateString(e,t){return e.length<=t?e:e.slice(0,t)+"..."}function versionCompare(e,t,r){var o=r&&r.lexicographical,l=r&&r.zeroExtend,a=e.split("."),i=t.split(".");function s(e){return(o?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!a.every(s)||!i.every(s))return NaN;if(l){for(;a.length<i.length;)a.push("0");for(;i.length<a.length;)i.push("0")}o||(a=a.map(Number),i=i.map(Number));for(var n=0;n<a.length;++n){if(i.length==n)return 1;if(a[n]!=i[n])return a[n]>i[n]?1:-1}return a.length!=i.length?-1:0}function initialize(){browser.storage.local.get(dbVersionKey).then(e=>{let t=e[dbVersionKey]||"",r=browser.runtime.getManifest().version;""===t?browser.storage.local.get(null).then(e=>{let t=Object.keys(e);if(t.length>0){let o=[];for(let r of t){let t={settingUrl:r,settingColor:e[r][0],settingLabel:e[r][1],settingPosition:e[r][2],settingSize:e[r][3],settingFontSize:e[r][4]};o.push(t)}browser.storage.local.clear().then(()=>{browser.storage.local.set({[markersKey]:o}).then(()=>{browser.storage.local.set({[dbVersionKey]:r}).then(()=>{initializeDisplay()},onError)},onError)})}else browser.storage.local.set({[dbVersionKey]:r}).then(()=>{initializeDisplay()},onError)},onError):initializeDisplay()},onError)}function initializeDisplay(){browser.storage.local.get(markersKey).then(e=>{let t=e[markersKey]||[];if(t.length>0){$(".setting").remove(),showOrHideEmptyNotice(hide);for(let e in t)displaySetting(e,t[e].settingUrl,t[e].settingColor,t[e].settingLabel,t[e].settingPosition,t[e].settingSize,t[e].settingFontSize)}else showOrHideEmptyNotice(show)},onError)}function showOrHideEmptyNotice(e=null){null===e?initializeDisplay():$(".empty-notice").css("display",e)}function saveSwatches(e){browser.storage.local.set({[swatchesKey]:e}).then(null,onError)}function showMessage(e,t=!1){let r=t?"alert-danger":"alert-success";$(".alert-dismissible").length&&$(".alert-dismissible").alert("close"),$(".outer-wrapper .message-container").append('<div class="alert '+r+' alert-dismissible fade show col-12" role="alert">'+e+'<button type="button" class="close" data-dismiss="alert" aria-label="'+ariaLabelAlertClose+'"><span aria-hidden="true">&times;</span></button></div>'),window.setTimeout((function(){$(".alert-dismissible").alert("close")}),3e3)}function searchStoredMarkers(e,t,r=null){r&&(r=Number(r));for(let o=0;o<t.length;o++)if(t[o].settingUrl===e&&o!==r)return t[o]}function saveSettings(){let e=$(".settings-input #url").val(),t=pickr.getSelectedColor().toHEXA().toString(0),r=$(".settings-input #label").val(),o=$(".settings-input #font-size").val(),l=$(".settings-input #position").val(),a=$(".settings-input #size").val();""!==e&&""!==t&&""!==r?browser.storage.local.get(markersKey).then(i=>{let s=i[markersKey]||[];searchStoredMarkers(e,s)?showMessage(errorDuplicateMarker,!0):($(".alert-dismissible").length&&$(".alert-dismissible").alert("close"),$(".settings-input #url").val(""),$(".settings-input #label").val(""),$(".settings-input #font-size").val("14"),$(".settings-input #position").val("top-left"),$(".settings-input #size").val("normal"),storeSetting(i,e,t,r,l,a,o))},onError):showMessage(""===r?errorLabelEmpty:errorUrlEmpty,!0)}function storeSetting(e,t,r,o,l,a,i){let s=e[markersKey]||[],n={settingUrl:t,settingColor:r,settingLabel:o,settingPosition:l,settingSize:a,settingFontSize:i};s.push(n);let c=s.length+1;browser.storage.local.set({[markersKey]:s}).then(()=>{showOrHideEmptyNotice(hide),displaySetting(c,t,r,o,l,a,i)},onError)}function updateSetting(e,t,r,o,l,a,i,s,n){browser.storage.local.get(markersKey).then(c=>{let p=c[markersKey]||[],g=searchStoredMarkers(r,p,e);if(e=Number(e),g)showMessage(errorDuplicateMarker,!0);else{let c=p.filter((function(n,c){return n.settingUrl===t&&c===e&&(n.settingUrl=r,n.settingColor=o,n.settingLabel=l,n.settingFontSize=s,n.settingPosition=a,n.settingSize=i),!0}));browser.storage.local.set({[markersKey]:c}).then(()=>{displaySetting(e,r,o,l,a,i,s,n)},onError)}},onError)}function deleteSetting(e,t){browser.storage.local.get(markersKey).then(r=>{let o=r[markersKey]||[],l=searchStoredMarkers(e,o);if(t=Number(t),l){let r=o.filter((function(r,o){return r.settingUrl!==e&&o!==t}));browser.storage.local.set({[markersKey]:r}).then(()=>{showOrHideEmptyNotice()},onError)}},onError)}function clearAll(){$(".settings-container .setting").each((e,t)=>{$(t).remove()}),browser.storage.local.set({[markersKey]:[]}).then(null,onError),showOrHideEmptyNotice(show)}function displaySetting(e,t,r,o,l,a,i,s=null){let n="14px";void 0!==i?n=fontSizeMap.reduce((function(e,t){return t.value===i&&(e=t.label),e}),{}):i="14";let c=positionsMap.reduce((function(e,t){return t.value===l&&(e=t.label),e}),{}),p=sizeSelectNormal;void 0!==a?p=sizesMap.reduce((function(e,t){return t.value===a&&(e=t.label),e}),{}):a="normal";let g=truncateString(t,30),h=he.encode(g),u=$("<div/>",{class:"setting"}),b=$("<div/>",{class:"row no-gutters my-1 align-items-center display-container"}),d='<div class="row d-flex align-items-center"><div class="col-3 align-self-center"><b>'+truncateString(o,30)+'</b></div><div class="col-4 align-self-center">'+h+'</div> <div class="col-5 align-self-center">'+n+", "+p+" "+displayAt+" "+c+"</div> </div>",m=$("<div/>",{class:"col-10 display-labelUrl",html:d,click:function(){b.hide(),k.show()}}),w=$("<div/>",{class:"col-1 display-color",html:'<div class="display-color-color" style="background-color: '+r+';"></div>',click:function(){b.hide(),k.show()}}),v=$("<div/>",{class:"col-1 display-delete"}),S=$("<button/>",{class:"btn btn-danger btn-sm delete",html:'<i class="fas fa-trash fa-lg"></i>',click:function(){$(this).parent().parent().parent().remove(),deleteSetting(t,e)}}),k=$("<div/>",{class:"row no-gutters my-3 edit-container",style:"display: none;"}),f=$("<div/>",{class:"col-10 pr-1 mb-2 edit-url-container"}),y=$("<input/>",{class:"form-control edit-url",placeholder:inputUrlFragmentPlaceholder,value:t}),P=$("<input/>",{type:"hidden",value:e}),M=$("<div/>",{class:"col-1 pr-1 mb-2 edit-color"}),z=$("<input/>",{class:"color-picker",value:r}),B=$("<div/>",{class:"col-3 pr-2 edit-label-container"}),A=$("<input/>",{class:"form-control edit-label",placeholder:inputLabelPlaceholder,value:o}),E=$("<div/>",{class:"col-2 pr-2 edit-font-size-container"}),C=$("<select/>",{class:"form-control edit-font-size"});for(let e=0;e<fontSizeMap.length;e++)fontSizeMap[e].value===i?C.append(new Option(fontSizeMap[e].label,fontSizeMap[e].value,!0,!0)):C.append(new Option(fontSizeMap[e].label,fontSizeMap[e].value));let K=$("<div/>",{class:"col-3 edit-position-container"}),L=$("<select/>",{class:"form-control edit-position"});for(let e=0;e<positionsMap.length;e++)positionsMap[e].value===l?L.append(new Option(positionsMap[e].label,positionsMap[e].value,!0,!0)):L.append(new Option(positionsMap[e].label,positionsMap[e].value));let x=$("<div/>",{class:"col-3 pr-2 edit-size-container"}),U=$("<select/>",{class:"form-control edit-size"});for(let e=0;e<sizesMap.length;e++)sizesMap[e].value===a?U.append(new Option(sizesMap[e].label,sizesMap[e].value,!0,!0)):U.append(new Option(sizesMap[e].label,sizesMap[e].value));let N=$("<div/>",{class:"col-1 mb-2 edit-delete"}),O=$("<button/>",{class:"btn btn-success btn-sm update",html:'<i class="fas fa-pencil-alt fa-lg"></i>',click:function(){let e=P.val(),s=y.val(),n=z.val(),c=A.val(),p=C.val(),g=L.val(),h=U.val();s===t&&n===r&&c===o&&p===i&&g===l&&h===a||updateSetting(e,t,s,n,c,g,h,p,u)}}),R=$("<div/>",{class:"col-1 edit-cancel"}),_=$("<button/>",{class:"btn btn-secondary btn-sm cancel",html:'<i class="fas fa-times fa-lg"></i>',click:function(){b.show(),k.hide(),y.val(t),z.val(r),A.val(o),L.val(l),U.val(a),C.val(i)}});f.append(y),f.append(P),M.append(z),E.append(C),K.append(L),x.append(U),N.append(O),B.append(A),R.append(_),k.append(f),k.append(M),k.append(N),k.append(B),k.append(E),k.append(K),k.append(x),k.append(R),v.append(S),b.append(m),b.append(w),b.append(v),u.append(b),u.append(k),s?s.replaceWith(u):$(".settings-container").append(u),browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]);let t=Pickr.create({el:z[0],theme:"nano",default:r,useAsButton:!1,swatches:colorSwatches,components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}},i18n:{"ui:dialog":colorPickerUiDialog,"btn:toggle":colorPickerBtnToggle,"btn:swatch":colorPickerBtnSwatch,"btn:last-color":colorPickerBtnLastColor,"btn:save":colorPickerBtnSave,"btn:cancel":colorPickerBtnCancel,"btn:clear":colorPickerBtnClear,"aria:btn:save":colorPickerAriaBtnSave,"aria:btn:cancel":colorPickerAriaBtnCancel,"aria:btn:clear":colorPickerAriaBtnClear,"aria:input":colorPickerAriaInput,"aria:palette":colorPickerAriaPalette,"aria:hue":colorPickerAriaHue,"aria:opacity":colorPickerAriaOpacity}});t.on("save",(e,r)=>{z.val(e.toHEXA().toString(0));let o=t.getSwatches();o.includes(e.toRGBA().toString(0))||(7===o.length&&o.pop(),o.unshift(e.toRGBA().toString(0)),t.setSwatches(o),saveSwatches(o)),r.hide()}),t.on("show",()=>{browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),t.setSwatches(colorSwatches)},onError)})},onError)}Pickr.prototype.getSwatches=function(){return this._swatchColors.reduce((e,t)=>(e.push(t.color.toRGBA().toString(0)),e),[])},Pickr.prototype.setSwatches=function(e){if(e.length){for(let e=this._swatchColors.length-1;e>-1;e--)this.removeSwatch(e);e.forEach(e=>this.addSwatch(e))}},$(document).ready(()=>{initialize(),$("html").attr("lang",languageCode);let e=$(".clear"),t=$(".options");$(".save").click(()=>{saveSettings()}),e.click(()=>{clearAll()}),t.click(()=>{browser.runtime.openOptionsPage()}),$(document).keydown((function(e){if("Enter"!==e.key&&"NumpadEnter"!==e.key||saveSettings(),"Escape"!==e.key)return!0;window.close()})),browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),pickr=Pickr.create({el:".color-picker",theme:"nano",useAsButton:!1,swatches:colorSwatches,components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}},i18n:{"ui:dialog":colorPickerUiDialog,"btn:toggle":colorPickerBtnToggle,"btn:swatch":colorPickerBtnSwatch,"btn:last-color":colorPickerBtnLastColor,"btn:save":colorPickerBtnSave,"btn:cancel":colorPickerBtnCancel,"btn:clear":colorPickerBtnClear,"aria:btn:save":colorPickerAriaBtnSave,"aria:btn:cancel":colorPickerAriaBtnCancel,"aria:btn:clear":colorPickerAriaBtnClear,"aria:input":colorPickerAriaInput,"aria:palette":colorPickerAriaPalette,"aria:hue":colorPickerAriaHue,"aria:opacity":colorPickerAriaOpacity}}),pickr.on("save",(e,t)=>{let r=pickr.getSwatches();r.includes(e.toRGBA().toString(0))||(7===r.length&&r.pop(),r.unshift(e.toRGBA().toString(0)),pickr.setSwatches(r),saveSwatches(r)),t.hide()}),pickr.on("show",()=>{browser.storage.local.get(swatchesKey).then(e=>{e[swatchesKey]&&(colorSwatches=e[swatchesKey]),pickr.setSwatches(colorSwatches)},onError)}),pickr.on("init",e=>{$(".pcr-button").attr("tabindex","2")})},onError),$(".empty-notice").html(noticeNoRibbons),e.html(buttonClearAll),t.html(buttonOptions),browser.storage.local.get(searchModeKey).then(e=>{e[searchModeKey]||!1?$("#url").attr("placeholder",inputUrlFragmentRegExpPlaceholder):$("#url").attr("placeholder",inputUrlFragmentPlaceholder)}),$("#color").attr("placeholder",inputColorPlaceholder),$("#label").attr("placeholder",inputLabelPlaceholder),$('#position option[value="top-left"]').html(positionSelectTopLeft),$('#position option[value="top-right"]').html(positionSelectTopRight),$('#position option[value="bottom-left"]').html(positionSelectBottomLeft),$('#position option[value="bottom-right"]').html(positionSelectBottomRight),$('#size option[value="extra-small"]').html(sizeSelectExtraSmall),$('#size option[value="small"]').html(sizeSelectSmall),$('#size option[value="normal"]').html(sizeSelectNormal),$('#size option[value="large"]').html(sizeSelectLarge),$('#size option[value="extra-large"]').html(sizeSelectExtraLarge)});
//# sourceMappingURL=environment-marker.min.js.map
