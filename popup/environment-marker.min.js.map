{"version":3,"sources":["environment-marker.js"],"names":["hide","show","positionsMap","value","label","exportFile","pickr","onError","error","console","log","truncateString","str","num","length","slice","initialize","browser","storage","local","get","then","results","settingsUrls","Object","keys","showOrHideEmptyNotice","settingUrl","displaySetting","action","$","css","showErrorMessage","textMsg","remove","append","saveSettings","urlIn","colorIn","labelIn","positionIn","importFlag","val","settingColor","getSelectedColor","toHEXA","toString","settingLabel","settingPosition","result","storeSetting","set","[object Object]","settingPositionDisplay","reduce","accumulator","currentValue","innerSettingsContainer","class","displayContainer","displayLabelUrl","text","click","editContainer","displayColor","html","deleteBtnContainer","deleteBtn","this","parent","style","editUrlInputContainer","editUrlInput","editColorInputContainer","editColorInput","updateBtnContainer","updateBtn","urlEditVal","colorEditVal","labelEditVal","editLabelInput","positionEditVal","optionsSelect","updateSetting","editLabelInputContainer","optionsSelectContainer","i","Option","cancelBtnContainer","cancelBtn","Pickr","create","el","theme","default","useAsButton","swatches","components","preview","opacity","hue","interaction","hex","rgba","hsla","hsva","cmyk","input","clear","save","on","color","instance","newSettingUrl","clearAll","each","index","element","makeJsonExportFile","data","Blob","type","window","URL","revokeObjectURL","createObjectURL","exportConfig","configurations","push","url","position","configurations_json","JSON","stringify","link","document","createElement","setAttribute","href","body","appendChild","requestAnimationFrame","event","MouseEvent","dispatchEvent","removeChild","importConfig","importFileInput","getElementById","importFile","files","reader","FileReader","addEventListener","import_config_obj","parse","forEach","arrayItem","readAsText","ready","toggle","keydown","key","close"],"mappings":"AAAA,MAAMA,KAAO,OACPC,KAAO,QACPC,aAAe,CACnB,CAACC,MAAO,WAAYC,MAAO,YAC3B,CAACD,MAAO,YAAaC,MAAO,aAC5B,CAACD,MAAO,cAAeC,MAAO,eAC9B,CAACD,MAAO,eAAgBC,MAAO,iBAEjC,IAAIC,WAAa,KACbC,MAAQ,KAEZ,SAASC,QAAQC,GACfC,QAAQC,IAAIF,GAGd,SAASG,eAAeC,EAAKC,GAC3B,OAAID,EAAIE,QAAUD,EACTD,EAEFA,EAAIG,MAAM,EAAGF,GAAO,MAG7B,SAASG,aACPC,QAAQC,QAAQC,MAAMC,IAAI,MAAMC,KAAMC,IACpC,IAAIC,EAAeC,OAAOC,KAAKH,GAC/BC,EAAaT,OAAS,EAAIY,sBAAsB1B,MAAQ0B,sBAAsBzB,MAC9E,IAAK,IAAI0B,KAAcJ,EACrBK,eAAeD,EAAYL,EAAQK,GAAY,GAAIL,EAAQK,GAAY,GAAIL,EAAQK,GAAY,KAEhGpB,SAGL,SAASmB,sBAAsBG,EAAS,MAClCA,IAAW5B,MAAQ4B,IAAW7B,KAChCiB,QAAQC,QAAQC,MAAMC,IAAI,MAAMC,KAAMC,IACpC,IAAIC,EAAeC,OAAOC,KAAKH,GAC/BQ,EAAE,iBAAiBC,IAAI,UAAWR,EAAaT,OAAS,EAAI,OAAS,UACpEP,SAEHuB,EAAE,iBAAiBC,IAAI,UAAWF,GAKtC,SAASG,iBAAiBC,GACpBH,EAAE,4CAA4ChB,QAChDgB,EAAE,4CAA4CI,SAC9CJ,EAAE,qCAAqCK,OAAO,6BAA6BF,EAAQ,WAEnFH,EAAE,qCAAqCK,OAAO,6BAA6BF,EAAQ,UAKvF,SAASG,aAAaC,EAAOC,EAASC,EAASC,EAAYC,GAAa,GACtE,IAAId,EAAac,EAAaJ,EAAQP,EAAE,wBAAwBY,MAC5DC,EAAeF,EAAaH,EAAUhC,MAAMsC,mBAAmBC,SAASC,SAAS,GACjFC,EAAeN,EAAaF,EAAUT,EAAE,0BAA0BY,MAClEM,EAAmBP,EAAaD,EAAaV,EAAE,6BAA6BY,MAE7D,KAAff,GAAsC,KAAjBgB,GAAwC,KAAjBI,EAC9C9B,QAAQC,QAAQC,MAAMC,IAAIO,GAAYN,KAAM4B,IAC5BzB,OAAOC,KAAKwB,GAEdnC,OAAS,GACfgB,EAAE,4CAA4ChB,QAChDgB,EAAE,4CAA4CI,SAGhDJ,EAAE,wBAAwBY,IAAI,IAC9BZ,EAAE,0BAA0BY,IAAI,IAChCZ,EAAE,6BAA6BY,IAAI,YAEnCQ,aAAavB,EAAYgB,EAAcI,EAAcC,IAGrDhB,iBAAiB,wCAElBzB,SAGmByB,iBAAL,KAAjBe,EAAuC,gBAAoC,eAK/E,SAASG,aAAavB,EAAYgB,EAAcI,EAAcC,GAC5D/B,QAAQC,QAAQC,MAAMgC,IAAI,CAAEC,CAACzB,GAAc,CAACgB,EAAcI,EAAcC,KAAoB3B,KAAK,KAC/FK,sBAAsB1B,MACtB4B,eAAeD,EAAYgB,EAAcI,EAAcC,IACtDzC,SAIL,SAASqB,eAAeD,EAAYgB,EAAcI,EAAcC,GAC9D,IAAIK,EAAyBnD,aAAaoD,QAAO,SAASC,EAAaC,GAIrE,OAHIA,EAAarD,OAAS6C,IACxBO,EAAcC,EAAapD,OAEtBmD,IACN,IAECE,EAAyB3B,EAAG,SAAU,CAAE4B,MAAS,YACjDC,EAAmB7B,EAAG,SAAU,CAAE4B,MAAS,0CAE3CE,EAAkB9B,EAAG,SAAU,CACjC4B,MAAS,+BACTG,KAAMlD,eAAeoC,EAAc,IAAM,KAAOpC,eAAegB,EAAY,IAAM,QAAU0B,EAC3FS,MAAO,WACLH,EAAiB3D,OACjB+D,EAAc9D,UAId+D,EAAelC,EAAG,SAAU,CAC9B4B,MAAS,2BACTO,KAAM,iCAAmCtB,EAAe,YACxDmB,MAAO,WACLH,EAAiB3D,OACjB+D,EAAc9D,UAIdiE,EAAqBpC,EAAG,SAAU,CACpC4B,MAAS,yBAGPS,EAAYrC,EAAG,YAAa,CAC9B4B,MAAS,+BACTO,KAAM,qCACNH,MAAO,WACLhC,EAAEsC,MAAMC,SAASA,SAASA,SAASnC,SACnCjB,QAAQC,QAAQC,MAAMe,OAAOP,GAC7BD,2BAIAqC,EAAgBjC,EAAG,SAAU,CAC/B4B,MAAS,qCACTY,MAAS,mBAGPC,EAAwBzC,EAAG,SAAU,CACvC4B,MAAS,wCAGPc,EAAe1C,EAAG,WAAY,CAChC4B,MAAS,wBACTvD,MAAOwB,IAGL8C,EAA0B3C,EAAG,SAAU,CACzC4B,MAAS,+BAGPgB,EAAiB5C,EAAG,WAAY,CAClC4B,MAAS,eACTvD,MAAOwC,IAGLgC,EAAqB7C,EAAG,SAAU,CACpC4B,MAAS,2BAGPkB,EAAY9C,EAAG,YAAa,CAC9B4B,MAAS,gCACTO,KAAM,0CACNH,MAAO,WACL,IAAIe,EAAaL,EAAa9B,MAC1BoC,EAAeJ,EAAehC,MAC9BqC,EAAeC,EAAetC,MAC9BuC,EAAkBC,EAAcxC,MAEhCmC,IAAelD,GAAcmD,IAAiBnC,GAAgBoC,IAAiBhC,GAAgBkC,IAAoBjC,IACrHmC,cAAcxD,EAAYkD,EAAYC,EAAcC,EAAcE,GAClExB,EAAuBvB,aAKzBkD,EAA0BtD,EAAG,SAAU,CACzC4B,MAAS,oCAGPsB,EAAiBlD,EAAG,WAAY,CAClC4B,MAAS,0BACTvD,MAAO4C,IAGLsC,EAAyBvD,EAAG,SAAU,CACxC4B,MAAS,uCAGPwB,EAAgBpD,EAAG,YAAa,CAClC4B,MAAS,+BAGX,IAAK,IAAI4B,EAAI,EAAGA,EAAIpF,aAAaY,OAAQwE,IACnCpF,aAAaoF,GAAGnF,QAAU6C,EAC5BkC,EAAc/C,OAAO,IAAIoD,OAAOrF,aAAaoF,GAAGlF,MAAOF,aAAaoF,GAAGnF,OAAO,GAAM,IAEpF+E,EAAc/C,OAAO,IAAIoD,OAAOrF,aAAaoF,GAAGlF,MAAOF,aAAaoF,GAAGnF,QAI3E,IAAIqF,EAAqB1D,EAAG,SAAU,CACpC4B,MAAS,sBAGP+B,EAAY3D,EAAG,YAAa,CAC9B4B,MAAS,kCACTO,KAAM,qCACNH,MAAO,WACLH,EAAiB1D,OACjB8D,EAAc/D,OACdwE,EAAa9B,IAAIf,GACjB+C,EAAehC,IAAIC,GACnBqC,EAAetC,IAAIK,GACnBmC,EAAcxC,IAAIM,MAItBuB,EAAsBpC,OAAOqC,GAC7BC,EAAwBtC,OAAOuC,GAC/BW,EAAuBlD,OAAO+C,GAC9BP,EAAmBxC,OAAOyC,GAC1BQ,EAAwBjD,OAAO6C,GAC/BQ,EAAmBrD,OAAOsD,GAE1B1B,EAAc5B,OAAOoC,GACrBR,EAAc5B,OAAOsC,GACrBV,EAAc5B,OAAOwC,GACrBZ,EAAc5B,OAAOiD,GACrBrB,EAAc5B,OAAOkD,GACrBtB,EAAc5B,OAAOqD,GAErBtB,EAAmB/B,OAAOgC,GAE1BR,EAAiBxB,OAAOyB,GACxBD,EAAiBxB,OAAO6B,GACxBL,EAAiBxB,OAAO+B,GAExBT,EAAuBtB,OAAOwB,GAC9BF,EAAuBtB,OAAO4B,GAE9BjC,EAAE,uBAAuBK,OAAOsB,GAEpBiC,MAAMC,OAAO,CACvBC,GAAIlB,EAAe,GACnBmB,MAAO,OACPC,QAASnD,EACToD,aAAa,EACbC,SAAU,CACR,wBACA,wBACA,wBACA,wBACA,wBACA,wBACA,yBAEFC,WAAY,CACVC,SAAS,EACTC,SAAS,EACTC,KAAK,EACLC,YAAa,CACXC,KAAK,EACLC,MAAM,EACNC,MAAM,EACNC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,OAAO,EACPC,MAAM,MAKNC,GAAG,OAAQ,CAACC,EAAOC,KACvBtC,EAAehC,IAAIqE,EAAMlE,SAASC,SAAS,IAC3CkE,EAAShH,SAKb,SAASmF,cAAcxD,EAAYsF,EAAetE,EAAcI,EAAcC,GAC5E/B,QAAQC,QAAQC,MAAMgC,IAAI,CAAEC,CAAC6D,GAAiB,CAACtE,EAAcI,EAAcC,KAAoB3B,KAAK,KAC9FM,IAAesF,EAEjBhG,QAAQC,QAAQC,MAAMe,OAAOP,GAAYN,KAAK,KAC5CO,eAAeqF,EAAetE,EAAcI,EAAcC,IACzDzC,SAGHqB,eAAeqF,EAAetE,EAAcI,EAAcC,IAE3DzC,SAIL,SAAS2G,WACPpF,EAAE,gCAAgCqF,KAAK,CAACC,EAAOC,KAC7CA,EAAQnF,WAEVjB,QAAQC,QAAQC,MAAMyF,QACtBlF,sBAAsBzB,MAIxB,SAASqH,mBAAmBzD,GAC1B,IAAI0D,EAAO,IAAIC,KAAK,CAAC3D,GAAO,CAAE4D,KAAM,qBASpC,OALmB,OAAfpH,YACFqH,OAAOC,IAAIC,gBAAgBvH,YAG7BA,WAAaqH,OAAOC,IAAIE,gBAAgBN,GACjClH,WAIT,SAASyH,eACP7G,QAAQC,QAAQC,MAAMC,IAAI,MAAMC,KAAMC,IACpC,IAAIC,EAAeC,OAAOC,KAAKH,GAC3ByG,EAAiB,GAErB,GAAIxG,EAAaT,OAAS,EAAG,CAC3B,IAAK,IAAIa,KAAcJ,EACrBwG,EAAeC,KAAK,CAClBC,IAAQtG,EACRoF,MAAUzF,EAAQK,GAAY,GAC9BvB,MAAUkB,EAAQK,GAAY,GAC9BuG,SAAa5G,EAAQK,GAAY,KAIrC,IAAIwG,EAAsBC,KAAKC,UAAUN,GACrCO,EAAOC,SAASC,cAAc,KAClCF,EAAKG,aAAa,WAAY,uBAC9BH,EAAKI,KAAOpB,mBAAmBa,GAC/BI,SAASI,KAAKC,YAAYN,GAG1BZ,OAAOmB,uBAAsB,WAC3B,IAAIC,EAAQ,IAAIC,WAAW,SAC3BT,EAAKU,cAAcF,GACnBP,SAASI,KAAKM,YAAYX,QAG7B/H,SAIL,SAAS2I,eACP,IAAIC,EAAkBZ,SAASa,eAAe,cAC1CC,EAAaF,EAAgBG,MAAM,GACvC,MAAMC,EAAS,IAAIC,WAGnBD,EAAOE,iBAAiB,QAAQ,WAC9B,IAAIC,EAAoBtB,KAAKuB,MAAMJ,EAAOtG,QAEtCyG,EAAkB5I,OAAS,GAC7B4I,EAAkBE,SAAQ,SAASC,GACjCzH,aAAayH,EAAU5B,IAAK4B,EAAU9C,MAAO8C,EAAUzJ,MAAOyJ,EAAU3B,UAAU,MAItFiB,EAAgBhJ,MAAQ,MAG1BoJ,EAAOO,WAAWT,GAGpBvH,EAAEyG,UAAUwB,MAAM,KAEhB/I,aAEAc,EAAE,SAASgC,MAAM,KACf1B,iBAGFN,EAAE,UAAUgC,MAAM,KAChBoD,aAGFpF,EAAE,kBAAkBgC,MAAM,KACxBhC,EAAE,4BAA4BkI,WAGhClI,EAAE,WAAWgC,MAAM,KACjBgE,iBAGFhG,EAAE,WAAWgC,MAAM,KACjBoF,iBAGFpH,EAAEyG,UAAU0B,SAAQ,SAASnB,GAO3B,GALkB,UAAdA,EAAMoB,KAAiC,gBAAdpB,EAAMoB,KACjC9H,eAIgB,WAAd0G,EAAMoB,IAGR,OAAO,EAFPxC,OAAOyC,WAMX7J,MAAQoF,MAAMC,OAAO,CACnBC,GAAI,gBACJC,MAAO,OACPE,aAAa,EACbC,SAAU,CACR,wBACA,wBACA,wBACA,wBACA,wBACA,wBACA,yBAEFC,WAAY,CACVC,SAAS,EACTC,SAAS,EACTC,KAAK,EACLC,YAAa,CACXC,KAAK,EACLC,MAAM,EACNC,MAAM,EACNC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,OAAO,EACPC,MAAM,MAKZvG,MAAMwG,GAAG,OAAQ,CAACC,EAAOC,KAEvBA,EAAShH","file":"environment-marker.min.js","sourcesContent":["const hide = 'none';\r\nconst show = 'block';\r\nconst positionsMap = [\r\n  {value: 'top-left', label: 'Top Left'},\r\n  {value: 'top-right', label: 'Top Right'},\r\n  {value: 'bottom-left', label: 'Bottom Left'},\r\n  {value: 'bottom-right', label: 'Bottom Right'}\r\n];\r\nlet exportFile = null;\r\nlet pickr = null;\r\n\r\nfunction onError(error) {\r\n  console.log(error);\r\n}\r\n\r\nfunction truncateString(str, num) {\r\n  if (str.length <= num) {\r\n    return str\r\n  }\r\n  return str.slice(0, num) + '...'\r\n}\r\n\r\nfunction initialize() {\r\n  browser.storage.local.get(null).then((results) => {\r\n    let settingsUrls = Object.keys(results);\r\n    settingsUrls.length > 0 ? showOrHideEmptyNotice(hide) : showOrHideEmptyNotice(show);\r\n    for (let settingUrl of settingsUrls) {\r\n      displaySetting(settingUrl, results[settingUrl][0], results[settingUrl][1], results[settingUrl][2]);\r\n    }\r\n  }, onError);\r\n}\r\n\r\nfunction showOrHideEmptyNotice(action = null) {\r\n  if (action !== show && action !== hide) {\r\n    browser.storage.local.get(null).then((results) => {\r\n      let settingsUrls = Object.keys(results);\r\n      $('.empty-notice').css('display', settingsUrls.length > 0 ? 'none' : 'block');\r\n    }, onError);\r\n  } else {\r\n    $('.empty-notice').css('display', action);\r\n  }\r\n}\r\n\r\n/* Show error message */\r\nfunction showErrorMessage(textMsg) {\r\n  if ($('.outer-wrapper .message-container .error').length) {\r\n    $('.outer-wrapper .message-container .error').remove();\r\n    $('.outer-wrapper .message-container').append('<div class=\"error col-12\">'+textMsg+'</div>');\r\n  } else {\r\n    $('.outer-wrapper .message-container').append('<div class=\"error col-12\">'+textMsg+'</div>');\r\n  }\r\n}\r\n\r\n/* Add a setting to the display and storage */\r\nfunction saveSettings(urlIn, colorIn, labelIn, positionIn, importFlag = false) {\r\n  let settingUrl = importFlag ? urlIn : $('.settings-input #url').val(),\r\n      settingColor = importFlag ? colorIn : pickr.getSelectedColor().toHEXA().toString(0),\r\n      settingLabel = importFlag ? labelIn : $('.settings-input #label').val(),\r\n      settingPosition =  importFlag ? positionIn : $('.settings-input #position').val();\r\n\r\n  if (settingUrl !== '' && settingColor !== '' && settingLabel !== '') {\r\n    browser.storage.local.get(settingUrl).then((result) => {\r\n      let objTest = Object.keys(result);\r\n\r\n      if (objTest.length < 1) {\r\n        if ($('.outer-wrapper .message-container .error').length) {\r\n          $('.outer-wrapper .message-container .error').remove();\r\n        }\r\n\r\n        $('.settings-input #url').val('');\r\n        $('.settings-input #label').val('');\r\n        $('.settings-input #position').val('top-left');\r\n\r\n        storeSetting(settingUrl, settingColor, settingLabel, settingPosition);\r\n      } else {\r\n        // Duplicate marker error message\r\n        showErrorMessage('Marker for this URL already exists!');\r\n      }\r\n    }, onError);\r\n  } else {\r\n    // Empty input error message\r\n    settingLabel === '' ? showErrorMessage('Enter Label !') : showErrorMessage('Enter URL !');\r\n  }\r\n}\r\n\r\n/* Store a new setting in local storage */\r\nfunction storeSetting(settingUrl, settingColor, settingLabel, settingPosition) {\r\n  browser.storage.local.set({ [settingUrl] : [settingColor, settingLabel, settingPosition] }).then(() => {\r\n    showOrHideEmptyNotice(hide);\r\n    displaySetting(settingUrl, settingColor, settingLabel, settingPosition);\r\n  }, onError);\r\n}\r\n\r\n/* Display a setting in the setting box */\r\nfunction displaySetting(settingUrl, settingColor, settingLabel, settingPosition) {\r\n  let settingPositionDisplay = positionsMap.reduce(function(accumulator, currentValue) {\r\n    if (currentValue.value == settingPosition) {\r\n      accumulator = currentValue.label;\r\n    }\r\n    return accumulator;\r\n  }, {});\r\n\r\n  let innerSettingsContainer = $( \"<div/>\", { \"class\": \"setting\" });\r\n  let displayContainer = $( \"<div/>\", { \"class\": \"row no-gutters mb-2 display-container\" });\r\n\r\n  let displayLabelUrl = $( \"<div/>\", {\r\n    \"class\": \"col-10 pr-2 display-labelUrl\",\r\n    text: truncateString(settingLabel, 35) + ' (' + truncateString(settingUrl, 35) + ') at ' + settingPositionDisplay,\r\n    click: function() {\r\n      displayContainer.hide();\r\n      editContainer.show();\r\n    }\r\n  });\r\n\r\n  let displayColor = $( \"<div/>\", {\r\n    \"class\": \"col-1 pr-2 display-color\",\r\n    html: '<div style=\"background-color: ' + settingColor + ';\"></div>',\r\n    click: function() {\r\n      displayContainer.hide();\r\n      editContainer.show();\r\n    }\r\n  });\r\n\r\n  let deleteBtnContainer = $( \"<div/>\", {\r\n    \"class\": \"col-1 display-delete\"\r\n  });\r\n\r\n  let deleteBtn = $( \"<button/>\", {\r\n    \"class\": \"btn btn-danger btn-sm delete\",\r\n    html: '<i class=\"fas fa-trash fa-lg\"></i>',\r\n    click: function() {\r\n      $(this).parent().parent().parent().remove();\r\n      browser.storage.local.remove(settingUrl);\r\n      showOrHideEmptyNotice();\r\n    }\r\n  });\r\n\r\n  let editContainer = $( \"<div/>\", {\r\n    \"class\": \"row no-gutters mb-2 edit-container\",\r\n    \"style\": \"display: none;\"\r\n  });\r\n\r\n  let editUrlInputContainer = $( \"<div/>\", {\r\n    \"class\": \"col-10 pr-1 mb-2 edit-url-container\"\r\n  });\r\n\r\n  let editUrlInput = $( \"<input/>\", {\r\n    \"class\": \"form-control edit-url\",\r\n    value: settingUrl\r\n  });\r\n\r\n  let editColorInputContainer = $( \"<div/>\", {\r\n    \"class\": \"col-1 pr-1 mb-2 edit-color\"\r\n  });\r\n\r\n  let editColorInput = $( \"<input/>\", {\r\n    \"class\": \"color-picker\",\r\n    value: settingColor\r\n  });\r\n\r\n  let updateBtnContainer = $( \"<div/>\", {\r\n    \"class\": \"col-1 mb-2 edit-delete\"\r\n  });\r\n\r\n  let updateBtn = $( \"<button/>\", {\r\n    \"class\": \"btn btn-success btn-sm update\",\r\n    html: '<i class=\"fas fa-pencil-alt fa-lg\"></i>',\r\n    click: function() {\r\n      let urlEditVal = editUrlInput.val();\r\n      let colorEditVal = editColorInput.val();\r\n      let labelEditVal = editLabelInput.val();\r\n      let positionEditVal = optionsSelect.val();\r\n\r\n      if (urlEditVal !== settingUrl || colorEditVal !== settingColor || labelEditVal !== settingLabel || positionEditVal !== settingPosition) {\r\n        updateSetting(settingUrl, urlEditVal, colorEditVal, labelEditVal, positionEditVal);\r\n        innerSettingsContainer.remove();\r\n      }\r\n    }\r\n  });\r\n\r\n  let editLabelInputContainer = $( \"<div/>\", {\r\n    \"class\": \"col-6 pr-2 edit-label-container\"\r\n  });\r\n\r\n  let editLabelInput = $( \"<input/>\", {\r\n    \"class\": \"form-control edit-label\",\r\n    value: settingLabel\r\n  });\r\n\r\n  let optionsSelectContainer = $( \"<div/>\", {\r\n    \"class\": \"col-5 pr-2 edit-position-container\"\r\n  });\r\n\r\n  let optionsSelect = $( \"<select/>\", {\r\n    \"class\": \"form-control edit-position\"\r\n  });\r\n\r\n  for (let i = 0; i < positionsMap.length; i++) {\r\n    if (positionsMap[i].value === settingPosition) {\r\n      optionsSelect.append(new Option(positionsMap[i].label, positionsMap[i].value, true, true));\r\n    } else {\r\n      optionsSelect.append(new Option(positionsMap[i].label, positionsMap[i].value));\r\n    }\r\n  }\r\n\r\n  let cancelBtnContainer = $( \"<div/>\", {\r\n    \"class\": \"col-1 edit-cancel\"\r\n  });\r\n\r\n  let cancelBtn = $( \"<button/>\", {\r\n    \"class\": \"btn btn-secondary btn-sm cancel\",\r\n    html: '<i class=\"fas fa-times fa-lg\"></i>',\r\n    click: function() {\r\n      displayContainer.show();\r\n      editContainer.hide();\r\n      editUrlInput.val(settingUrl);\r\n      editColorInput.val(settingColor);\r\n      editLabelInput.val(settingLabel);\r\n      optionsSelect.val(settingPosition);\r\n    }\r\n  });\r\n\r\n  editUrlInputContainer.append(editUrlInput);\r\n  editColorInputContainer.append(editColorInput);\r\n  optionsSelectContainer.append(optionsSelect);\r\n  updateBtnContainer.append(updateBtn);\r\n  editLabelInputContainer.append(editLabelInput);\r\n  cancelBtnContainer.append(cancelBtn);\r\n\r\n  editContainer.append(editUrlInputContainer);\r\n  editContainer.append(editColorInputContainer);\r\n  editContainer.append(updateBtnContainer);\r\n  editContainer.append(editLabelInputContainer);\r\n  editContainer.append(optionsSelectContainer);\r\n  editContainer.append(cancelBtnContainer);\r\n\r\n  deleteBtnContainer.append(deleteBtn);\r\n\r\n  displayContainer.append(displayLabelUrl);\r\n  displayContainer.append(displayColor);\r\n  displayContainer.append(deleteBtnContainer);\r\n\r\n  innerSettingsContainer.append(displayContainer);\r\n  innerSettingsContainer.append(editContainer);\r\n\r\n  $('.settings-container').append(innerSettingsContainer);\r\n\r\n  let pickr = Pickr.create({\r\n    el: editColorInput[0],\r\n    theme: 'nano',\r\n    default: settingColor,\r\n    useAsButton: false,\r\n    swatches: [\r\n      'rgba(244, 67,  54, 1)',\r\n      'rgba(233, 30,  99, 1)',\r\n      'rgba(156, 39, 176, 1)',\r\n      'rgba(103, 58, 183, 1)',\r\n      'rgba(63,  81, 181, 1)',\r\n      'rgba(33, 150, 243, 1)',\r\n      'rgba(3,  169, 244, 1)'\r\n    ],\r\n    components: {\r\n      preview: true,\r\n      opacity: false,\r\n      hue: true,\r\n      interaction: {\r\n        hex: false,\r\n        rgba: false,\r\n        hsla: false,\r\n        hsva: false,\r\n        cmyk: false,\r\n        input: true,\r\n        clear: false,\r\n        save: true\r\n      }\r\n    }\r\n  });\r\n\r\n  pickr.on('save', (color, instance) => {\r\n    editColorInput.val(color.toHEXA().toString(0));\r\n    instance.hide();\r\n  });\r\n}\r\n\r\n/* Update settings */\r\nfunction updateSetting(settingUrl, newSettingUrl, settingColor, settingLabel, settingPosition) {\r\n  browser.storage.local.set({ [newSettingUrl] : [settingColor, settingLabel, settingPosition] }).then(() => {\r\n    if (settingUrl !== newSettingUrl) {\r\n      // Changed URL\r\n      browser.storage.local.remove(settingUrl).then(() => {\r\n        displaySetting(newSettingUrl, settingColor, settingLabel, settingPosition);\r\n      }, onError);\r\n    } else {\r\n      // Change settings\r\n      displaySetting(newSettingUrl, settingColor, settingLabel, settingPosition);\r\n    }\r\n  }, onError);\r\n}\r\n\r\n/* Clear all settings from the display and storage */\r\nfunction clearAll() {\r\n  $('.settings-container .setting').each((index, element) => {\r\n    element.remove();\r\n  });\r\n  browser.storage.local.clear();\r\n  showOrHideEmptyNotice(show);\r\n}\r\n\r\n/* Make a URL Object from json text */\r\nfunction makeJsonExportFile(text) {\r\n  let data = new Blob([text], { type: 'application/json' });\r\n\r\n  // If we are replacing a previously generated file we need to\r\n  // manually revoke the object URL to avoid memory leaks.\r\n  if (exportFile !== null) {\r\n    window.URL.revokeObjectURL(exportFile);\r\n  }\r\n\r\n  exportFile = window.URL.createObjectURL(data);\r\n  return exportFile;\r\n}\r\n\r\n/* Get all configurations from the storage and output a json file */\r\nfunction exportConfig() {\r\n  browser.storage.local.get(null).then((results) => {\r\n    let settingsUrls = Object.keys(results),\r\n        configurations = [];\r\n\r\n    if (settingsUrls.length > 0) {\r\n      for (let settingUrl of settingsUrls) {\r\n        configurations.push({\r\n          \"url\" : settingUrl,\r\n          \"color\" : results[settingUrl][0],\r\n          \"label\" : results[settingUrl][1],\r\n          \"position\" : results[settingUrl][2]\r\n        });\r\n      }\r\n\r\n      let configurations_json = JSON.stringify(configurations);\r\n      let link = document.createElement('a');\r\n      link.setAttribute('download', 'configurations.json');\r\n      link.href = makeJsonExportFile(configurations_json);\r\n      document.body.appendChild(link);\r\n\r\n      // wait for the link to be added to the document\r\n      window.requestAnimationFrame(function () {\r\n        let event = new MouseEvent('click');\r\n        link.dispatchEvent(event);\r\n        document.body.removeChild(link);\r\n      });\r\n    }\r\n  }, onError);\r\n}\r\n\r\n/* Read import file and load all settings into the stoage */\r\nfunction importConfig() {\r\n  let importFileInput = document.getElementById(\"importFile\"),\r\n      importFile = importFileInput.files[0];\r\n  const reader = new FileReader();\r\n\r\n  // This event listener will happen when the reader has read the file\r\n  reader.addEventListener('load', function() {\r\n    let import_config_obj = JSON.parse(reader.result); // Parse the result into an object\r\n\r\n    if (import_config_obj.length > 0) {\r\n      import_config_obj.forEach(function(arrayItem) {\r\n        saveSettings(arrayItem.url, arrayItem.color, arrayItem.label, arrayItem.position, true)\r\n      });\r\n    }\r\n\r\n    importFileInput.value = \"\";\r\n  });\r\n\r\n  reader.readAsText(importFile); // Read the uploaded file\r\n}\r\n\r\n$(document).ready(() => {\r\n  /* Display previously saved markers on startup */\r\n  initialize();\r\n\r\n  $('.save').click(() => {\r\n    saveSettings();\r\n  });\r\n\r\n  $('.clear').click(() => {\r\n    clearAll();\r\n  });\r\n\r\n  $('.import-export').click(() => {\r\n    $('.export-import-container').toggle();\r\n  });\r\n\r\n  $('.export').click(() => {\r\n    exportConfig();\r\n  });\r\n\r\n  $('.import').click(() => {\r\n    importConfig();\r\n  });\r\n\r\n  $(document).keydown(function(event) {\r\n    // Enter\r\n    if (event.key === 'Enter' || event.key === 'NumpadEnter') {\r\n      saveSettings();\r\n    }\r\n\r\n    // Escape\r\n    if (event.key === 'Escape') {\r\n      window.close();\r\n    } else {\r\n      return true;\r\n    }\r\n  });\r\n\r\n  pickr = Pickr.create({\r\n    el: '.color-picker',\r\n    theme: 'nano',\r\n    useAsButton: false,\r\n    swatches: [\r\n      'rgba(244, 67,  54, 1)',\r\n      'rgba(233, 30,  99, 1)',\r\n      'rgba(156, 39, 176, 1)',\r\n      'rgba(103, 58, 183, 1)',\r\n      'rgba(63,  81, 181, 1)',\r\n      'rgba(33, 150, 243, 1)',\r\n      'rgba(3,  169, 244, 1)'\r\n    ],\r\n    components: {\r\n      preview: true,\r\n      opacity: false,\r\n      hue: true,\r\n      interaction: {\r\n        hex: false,\r\n        rgba: false,\r\n        hsla: false,\r\n        hsva: false,\r\n        cmyk: false,\r\n        input: true,\r\n        clear: false,\r\n        save: true\r\n      }\r\n    }\r\n  });\r\n\r\n  pickr.on('save', (color, instance) => {\r\n    //$('.settings-input #color').val(color.toHEXA().toString(0));\r\n    instance.hide();\r\n  });\r\n});\r\n"]}